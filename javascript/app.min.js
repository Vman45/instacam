!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);let o={width:400,height:300,autostart:!0,camera:!0,framerate:30,ratio:4/3,sound:!1,volume:100,mirror:!1,opacity:1,brightness:1,contrast:1,saturation:1,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",blend:{},filter:null,done:null,fail:null,unsupported:null},n="requestAnimationFrame"in window&&"mediaDevices"in navigator&&"Promise"in window;let r=document.querySelector(".log"),s=document.querySelector(".preview"),a=new class{constructor(t,e){if(this._options=Object.assign({},o,e),n){if("string"==typeof t&&(t=document.querySelector(t)),void 0===t||null===t||"canvas"!==t.nodeName.toLowerCase())throw new Error("Invalid viewport, you need to pass a valid selector or HTML5 canvas element");this.viewport=t,this.viewport.width=this._options.width,this.viewport.height=this._options.height,this._media=document.createElement("video"),this._media.style.display="none",this._media.autoplay=!0,this._media.width=this._options.width,this._media.height=this._options.height,this.viewport.parentNode.insertBefore(this._media,this.viewport.nextSibling),this.mirror=this._options.mirror,!0===this._options.autostart&&(this._compute(),this._capture())}else"function"==typeof this._options.unsupported&&this._options.unsupported()}_capture(){try{navigator.mediaDevices.getUserMedia({audio:this._options.sound,video:(()=>!1!==this._options.camera&&{frameRate:this._options.framerate,aspectRatio:this._options.ratio})()}).then(t=>{this._stream=t,this._media.srcObject=t,this.volume=this._options.volume;const e=()=>{"function"!=typeof this._options.filter?this.viewport.getContext("2d").drawImage(this._media,0,0,this._options.width,this._options.height):(void 0===this._buffer&&(this._buffer=document.createElement("canvas"),this._buffer.style.display="none",this._buffer.width=this._options.width,this._buffer.height=this._options.height,this.viewport.parentNode.insertBefore(this._buffer,this.viewport.nextSibling)),this._buffer.getContext("2d").drawImage(this._media,0,0,this._options.width,this._options.height),this.viewport.getContext("2d").putImageData(this._filter(this._buffer.getContext("2d").getImageData(0,0,this._options.width,this._options.height)),0,0)),requestAnimationFrame(e)};requestAnimationFrame(e),"function"==typeof this._options.done&&this._options.done()}).catch(t=>{"function"==typeof this._options.fail&&this._options.fail(t)})}catch(t){"function"==typeof this._options.fail&&this._options.fail(t)}}_compute(){if(this._style=this._options.opacity!==o.opacity?`opacity(${this._options.opacity}) `:"",this._style+=this._options.brightness!==o.brightness?`brightness(${this._options.brightness}) `:"",this._style+=this._options.contrast!==o.contrast?`contrast(${this._options.contrast}) `:"",this._style+=this._options.saturation!==o.saturation?`saturate(${this._options.saturation}) `:"",this._style+=this._options.hue!==o.hue?`hue-rotate(${this._options.hue}deg) `:"",this._style+=this._options.invert!==o.invert?`invert(${this._options.invert}) `:"",this._style+=this._options.grayscale!==o.grayscale?`grayscale(${this._options.grayscale}) `:"",this._style+=this._options.sepia!==o.sepia?`sepia(${this._options.sepia}) `:"",this._style+=this._options.blur!==o.blur?`blur(${this._options.blur}px) `:"",this._style+=this._options.url!==o.url?`url(${this._options.url}) `:"",this.viewport.style.filter=this._style,0!==Object.keys(this._options.blend).length){void 0===this._blend&&(this._blend=document.createElement("div"),this.viewport.parentNode.insertBefore(this._blend,this.viewport));const t=this.viewport.getBoundingClientRect();this._blend.style=`position:absolute;z-index:1;left:${t.left}px;top:${t.top}px;width:${t.width}px;height:${t.height}px;mix-blend-mode:${this._options.blend.mode};background:${this._options.blend.color};pointer-events:none;`}else void 0!==this._blend&&(this._blend.parentNode.removeChild(this._blend),delete this._blend)}_filter(t){let e=t.data;try{for(let t=0;t<this._options.height;t++)for(let i=0;i<this._options.width;i++){const o=4*(this._options.width*t+i),n=this._options.filter({offset:o,x:i,y:t,red:e[o],green:e[o+1],blue:e[o+2],alpha:e[o+3]});e[o]=n[0],e[o+1]=n[1],e[o+2]=n[2],e[o+3]=n[3]}return t}catch(t){throw new Error("Invalid filter, you need to return a valid [red, green, blue, alpha] pixel array")}}start(){this._compute(),this._capture()}stop(){void 0!==this._stream&&(this._stream.getTracks().forEach(function(t){t.stop()}),this._media.srcObject=null)}snap(t=0,e=0,i=this._options.width,o=this._options.height){if(i<=0||o<=0)throw new Error("Invalid snap area, you need to specify a positive width and height for your image capture");return this.viewport.getContext("2d").getImageData(t,e,i,o)}save(t="png",e=1){return this.viewport.toDataURL("image/"+t,e)}get volume(){return this._options.volume}set volume(t){if("number"!=typeof t||t<0||t>100)throw new Error("Invalid volume, you need to give a number between 0 and 100");this._media.volume=this._options.volume=t/100}get mirror(){return this._options.mirror}set mirror(t){if("boolean"!=typeof t)throw new Error("Invalid mirror mode, you need to give a boolean to enable or disable the mirror mode");let e=getComputedStyle(this.viewport).getPropertyValue("transform");e="none"!==e?e:"",this.viewport.style.transform=!0===t?`${e} scale(-1, 1)`:"",this._options.mirror=t}get opacity(){return this._options.opacity}set opacity(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid opacity, you need to give a number between 0 and 1");this._options.opacity=t,this._compute()}get brightness(){return this._options.brightness}set brightness(t){if("number"!=typeof t||t<0)throw new Error("Invalid brightness, you need to give a number above 0");this._options.brightness=t,this._compute()}get contrast(){return this._options.contrast}set contrast(t){if("number"!=typeof t||t<0)throw new Error("Invalid contrast, you need to give a number above 0");this._options.contrast=t,this._compute()}get saturation(){return this._options.saturation}set saturation(t){if("number"!=typeof t||t<0)throw new Error("Invalid saturation, you need to give a number above 0");this._options.saturation=t,this._compute()}get hue(){return this._options.hue}set hue(t){if("number"!=typeof t||t<0||t>360)throw new Error("Invalid hue, you need to give a number between 0 and 360");this._options.hue=t,this._compute()}get invert(){return this._options.invert}set invert(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid invert, you need to give a number between 0 and 1");this._options.invert=t,this._compute()}get grayscale(){return this._options.grayscale}set grayscale(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid grayscale, you need to give a number between 0 and 1");this._options.grayscale=t,this._compute()}get sepia(){return this._options.sepia}set sepia(t){if("number"!=typeof t||t<0||t>1)throw new Error("Invalid sepia, you need to give a number between 0 and 1");this._options.sepia=t,this._compute()}get blur(){return this._options.blur}set blur(t){if("number"!=typeof t||t<0)throw new Error("Invalid blur, you need to give a number above 0");this._options.blur=t,this._compute()}get url(){return this._options.url}set url(t){if("string"!=typeof t)throw new Error("Invalid url, you need to give a string");this._options.url=t,this._compute()}get blend(){return this._options.blend}set blend(t){if("object"!=typeof t)throw new Error("Invalid blend, you need to give a valid object with {mode|color} or an empty object to disable blending");this._options.blend=t,this._compute()}get filter(){return this._options.filter}set filter(t){if(null!==t&&"function"!=typeof t)throw new Error("Invalid filter, you need to give a function or null to disable the custom filtering");this._options.filter=t}get style(){return 0!==this._style.length?this._style.trim().split(" "):[]}}(document.querySelector("canvas"),{sound:!0,volume:0,done:function(){r.innerHTML="Instacam is working fine."},fail:function(t){r.innerHTML=`Sorry, Instacam failed to start because you didn't accept the requested permissions to access your camera, or something went wrong. Error: <strong>${t.message}</strong>`},unsupported:function(){r.innerHTML="Sorry, but it seems that your browser is not supporting requestAnimationFrame, mediaDevices or Promises. Try Instacam in another browser."}});function u(){document.querySelector('[name="quality"]').removeAttribute("disabled"),document.querySelector(".size").classList.remove("disabled");let t=a.save(document.querySelector('[name="format"]:checked').value,Number.parseFloat(document.querySelector('[name="quality"]').value)),e=document.createElement("img");e.setAttribute("width",400),e.setAttribute("height",300),e.setAttribute("src",t),s.innerHTML="",s.appendChild(e),document.querySelector(".size span").innerHTML=Math.round(3*t.length/4/1024)}Array.from(document.querySelectorAll('.property + [type="range"]')).forEach(function(t){const e=t.parentNode.querySelector(".value");t.setAttribute("data-default",t.value),t.addEventListener("input",function(){if(e.innerHTML=this.value,a[this.name]=Number.parseFloat(this.value),"volume"===this.name){const t=document.querySelector(".volume-state use");this.value<30?t.setAttribute("xlink:href","picture/sprite.svg#volume-mute"):this.value>=30&&this.value<=70?t.setAttribute("xlink:href","picture/sprite.svg#volume-down"):this.value>70&&t.setAttribute("xlink:href","picture/sprite.svg#volume-up")}}),t.addEventListener("mousedown",function(){e.innerHTML=this.value,e.classList.add("update")}),t.addEventListener("mouseup",function(){e.classList.remove("update")})}),Array.from(document.querySelectorAll('[name="filter"]')).forEach(function(t){t.addEventListener("change",function(){const t={none:null,noise:function(t){let e=Math.random();return[e*t.red,e*t.green,e*t.blue,t.alpha]},grayscale:function(t){let e=.2126*t.red+.7152*t.green+.0722*t.blue;return[e,e,e,t.alpha]},invert:function(t){return[255-t.red,255-t.green,255-t.blue,t.alpha]},threshold:function(t){return.2126*t.red+.7152*t.green+.0722*t.blue>=100?[255,255,255,255]:[0,0,0,255]},sobel:function(t){let e=Math.abs(t.x),i=Math.abs(t.y);return[t.red+e,t.green+i,t.blue+(e+i)/4,255]},pixel:function(t){return t.offset%10!=0?[window.red,window.green,window.blue,255]:(window.red=t.red,window.green=t.green,window.blue=t.blue,[t.red,t.green,t.blue,255])}};a.filter=t[this.value]})}),Array.from(document.querySelectorAll('[name="mirror"]')).forEach(function(t){t.addEventListener("change",function(){a.mirror="1"===t.value})}),document.querySelector('[name="snap"]').addEventListener("click",function(){let t=a.snap(),e=document.createElement("canvas");e.setAttribute("width",400),e.setAttribute("height",300),e.getContext("2d").putImageData(t,0,0),(null!==s.querySelector("img")||s.querySelectorAll("canvas").length>=16)&&(s.innerHTML=""),s.appendChild(e)}),Array.from(document.querySelectorAll('[name="format"]')).forEach(function(t){t.addEventListener("change",function(){u()})}),document.querySelector('[name="quality"]').addEventListener("input",function(){u()})}]);