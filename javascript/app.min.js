!function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);let i={width:400,height:300,autostart:!0,camera:!0,mode:"front",framerate:30,ratio:4/3,sound:!1,volume:100,mirror:!1,opacity:1,brightness:1,contrast:1,saturation:1,hue:0,invert:0,grayscale:0,sepia:0,blur:0,url:"",blend:{},filter:null,done:null,fail:null,unsupported:null},o="requestAnimationFrame"in window&&"mediaDevices"in navigator&&"Promise"in window;let s=document.querySelector(".log"),n=document.querySelector(".preview"),a=new class{constructor(e,t){if(this._props=Object.assign({},i,t),o){if("string"==typeof e&&(e=document.querySelector(e)),null==e||"canvas"!==e.nodeName.toLowerCase())throw new Error("Invalid viewport, you need to pass a valid selector or HTML5 canvas element");this.viewport=e,this.viewport.width=this._props.width,this.viewport.height=this._props.height,this._media=document.createElement("video"),this._media.style.display="none",this._media.autoplay=!0,this._media.width=this._props.width,this._media.height=this._props.height,this.viewport.parentNode.insertBefore(this._media,this.viewport.nextSibling),this.mirror=this._props.mirror,!0===this._props.autostart&&(this._compute(),this._capture())}else"function"==typeof this._props.unsupported&&this._props.unsupported()}_capture(){try{navigator.mediaDevices.getUserMedia({audio:this._props.sound,video:(()=>!1!==this._props.camera&&{frameRate:this._props.framerate,aspectRatio:this._props.ratio,facingMode:"front"===this._props.mode?"user":"environment"})()}).then(e=>{this._stream=e,this._media.srcObject=e,this.volume=this._props.volume;const t=()=>{"function"!=typeof this._props.filter?this.viewport.getContext("2d").drawImage(this._media,0,0,this._props.width,this._props.height):(void 0===this._buffer&&(this._buffer=document.createElement("canvas"),this._buffer.style.display="none",this._buffer.width=this._props.width,this._buffer.height=this._props.height,this.viewport.parentNode.insertBefore(this._buffer,this.viewport.nextSibling)),this._buffer.getContext("2d").drawImage(this._media,0,0,this._props.width,this._props.height),this.viewport.getContext("2d").putImageData(this._filter(this._buffer.getContext("2d").getImageData(0,0,this._props.width,this._props.height)),0,0)),requestAnimationFrame(t)};requestAnimationFrame(t),"function"==typeof this._props.done&&this._props.done()}).catch(e=>{"function"==typeof this._props.fail&&this._props.fail(e)})}catch(e){"function"==typeof this._props.fail&&this._props.fail(e)}}_compute(){if(this._style=this._props.opacity!==i.opacity?`opacity(${this._props.opacity}) `:"",this._style+=this._props.brightness!==i.brightness?`brightness(${this._props.brightness}) `:"",this._style+=this._props.contrast!==i.contrast?`contrast(${this._props.contrast}) `:"",this._style+=this._props.saturation!==i.saturation?`saturate(${this._props.saturation}) `:"",this._style+=this._props.hue!==i.hue?`hue-rotate(${this._props.hue}deg) `:"",this._style+=this._props.invert!==i.invert?`invert(${this._props.invert}) `:"",this._style+=this._props.grayscale!==i.grayscale?`grayscale(${this._props.grayscale}) `:"",this._style+=this._props.sepia!==i.sepia?`sepia(${this._props.sepia}) `:"",this._style+=this._props.blur!==i.blur?`blur(${this._props.blur}px) `:"",this._style+=this._props.url!==i.url?`url(${this._props.url}) `:"",this.viewport.style.filter=this._style,0!==Object.keys(this._props.blend).length){void 0===this._blend&&(this._blend=document.createElement("div"),this.viewport.parentNode.insertBefore(this._blend,this.viewport));const e=this.viewport.getBoundingClientRect();this._blend.style=`position:absolute;z-index:1;width:${e.width}px;height:${e.height}px;mix-blend-mode:${this._props.blend.mode};background:${this._props.blend.color};pointer-events:none;`}else void 0!==this._blend&&(this._blend.parentNode.removeChild(this._blend),delete this._blend)}_filter(e){let t=e.data;try{for(let e=0;e<this._props.height;e++)for(let r=0;r<this._props.width;r++){const i=4*(this._props.width*e+r),o=this._props.filter({offset:i,x:r,y:e,red:t[i],green:t[i+1],blue:t[i+2],alpha:t[i+3]});t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3]}return e}catch(e){throw new Error("Invalid filter, you need to return a valid [red, green, blue, alpha] pixel array")}}start(){this._compute(),this._capture()}stop(){void 0!==this._stream&&(this._stream.getTracks().forEach(function(e){e.stop()}),this._media.srcObject=null)}snap(e=0,t=0,r=this._props.width,i=this._props.height){if(r<=0||i<=0)throw new Error("Invalid snap area, you need to specify a positive width and height for your image capture");return this.viewport.getContext("2d").getImageData(e,t,r,i)}save(e="png",t=1){return this.viewport.toDataURL("image/"+e,t)}mute(){this._props.muted=this._media.muted=!0}unmute(){this._props.muted=this._media.muted=!1}get mode(){return this._props.mode}set mode(e){if("string"!=typeof e||"front"!==e&&"back"!==e)throw new Error("Invalid facing mode, you need to give a valid string front|back");this._props.mode=e,this._stream.getVideoTracks().forEach(function(e){e.stop()}),this._capture()}get muted(){return this._media.muted}get volume(){return this._props.volume}set volume(e){if("number"!=typeof e||e<0||e>100)throw new Error("Invalid volume, you need to give a number between 0 and 100");this._media.volume=this._props.volume=e/100}get mirror(){return this._props.mirror}set mirror(e){if("boolean"!=typeof e)throw new Error("Invalid mirror mode, you need to give a boolean to enable or disable the mirror mode");let t=getComputedStyle(this.viewport).getPropertyValue("transform");t="none"!==t?t:"",this.viewport.style.transform=!0===e?`${t} scale(-1, 1)`:"",this._props.mirror=e}get opacity(){return this._props.opacity}set opacity(e){if("number"!=typeof e||e<0||e>1)throw new Error("Invalid opacity, you need to give a number between 0 and 1");this._props.opacity=e,this._compute()}get brightness(){return this._props.brightness}set brightness(e){if("number"!=typeof e||e<0)throw new Error("Invalid brightness, you need to give a number above 0");this._props.brightness=e,this._compute()}get contrast(){return this._props.contrast}set contrast(e){if("number"!=typeof e||e<0)throw new Error("Invalid contrast, you need to give a number above 0");this._props.contrast=e,this._compute()}get saturation(){return this._props.saturation}set saturation(e){if("number"!=typeof e||e<0)throw new Error("Invalid saturation, you need to give a number above 0");this._props.saturation=e,this._compute()}get hue(){return this._props.hue}set hue(e){if("number"!=typeof e||e<0||e>360)throw new Error("Invalid hue, you need to give a number between 0 and 360");this._props.hue=e,this._compute()}get invert(){return this._props.invert}set invert(e){if("number"!=typeof e||e<0||e>1)throw new Error("Invalid invert, you need to give a number between 0 and 1");this._props.invert=e,this._compute()}get grayscale(){return this._props.grayscale}set grayscale(e){if("number"!=typeof e||e<0||e>1)throw new Error("Invalid grayscale, you need to give a number between 0 and 1");this._props.grayscale=e,this._compute()}get sepia(){return this._props.sepia}set sepia(e){if("number"!=typeof e||e<0||e>1)throw new Error("Invalid sepia, you need to give a number between 0 and 1");this._props.sepia=e,this._compute()}get blur(){return this._props.blur}set blur(e){if("number"!=typeof e||e<0)throw new Error("Invalid blur, you need to give a number above 0");this._props.blur=e,this._compute()}get url(){return this._props.url}set url(e){if("string"!=typeof e)throw new Error("Invalid url, you need to give a string");this._props.url=e,this._compute()}get blend(){return this._props.blend}set blend(e){if("object"!=typeof e)throw new Error("Invalid blend, you need to give a valid object with {mode|color} or an empty object to disable blending");this._props.blend=e,this._compute()}get filter(){return this._props.filter}set filter(e){if(null!==e&&"function"!=typeof e)throw new Error("Invalid filter, you need to give a function or null to disable the custom filtering");this._props.filter=e}get style(){return 0!==this._style.length?this._style.trim().split(" "):[]}get hardware(){if(void 0===this._stream)return null;let e=this._stream.getAudioTracks().filter(e=>"live"===e.readyState)[0],t=this._stream.getVideoTracks().filter(e=>"live"===e.readyState)[0];return{audio:void 0===e?null:{id:e.id,name:e.label},video:void 0===t?null:{id:t.id,name:t.label}}}}(document.querySelector("canvas"),{sound:!0,volume:0,done:()=>{s.innerHTML="Instacam is working fine."},fail:e=>{s.innerHTML=`Sorry, Instacam failed to start because you didn't accept the requested permissions to access your camera, or something went wrong. Error: <strong>${e.message}</strong>`},unsupported:()=>{s.innerHTML="Sorry, but it seems that your browser is not supporting requestAnimationFrame, mediaDevices or Promises. Try Instacam in another browser."}});function u(){document.querySelector('[name="quality"]').removeAttribute("disabled"),document.querySelector(".size").classList.remove("disabled");let e=a.save(document.querySelector('[name="format"]:checked').value,Number.parseFloat(document.querySelector('[name="quality"]').value)),t=document.createElement("img");t.setAttribute("width",400),t.setAttribute("height",300),t.setAttribute("src",e),n.innerHTML="",n.appendChild(t),document.querySelector(".size span").innerHTML=Math.round(3*e.length/4/1024)}Array.from(document.querySelectorAll('.property + [type="range"]')).forEach(e=>{const t=e.parentNode.querySelector(".value");e.setAttribute("data-default",e.value),e.addEventListener("input",()=>{if(t.innerHTML=e.value,a[e.name]=Number.parseFloat(e.value),"volume"===e.name){const t=document.querySelector(".volume-state use");e.value<30?t.setAttribute("xlink:href","picture/sprite.svg#volume-mute"):e.value>=30&&e.value<=70?t.setAttribute("xlink:href","picture/sprite.svg#volume-down"):e.value>70&&t.setAttribute("xlink:href","picture/sprite.svg#volume-up")}}),e.addEventListener("mousedown",()=>{t.innerHTML=e.value,t.classList.add("update")}),e.addEventListener("mouseup",()=>{t.classList.remove("update")})}),Array.from(document.querySelectorAll('[name="blend"]')).forEach(e=>{e.addEventListener("change",()=>{a.blend="none"===e.value?{}:{mode:e.value,color:"#217fcf"}})}),Array.from(document.querySelectorAll('[name="filter"]')).forEach(e=>{e.addEventListener("change",()=>{const t={none:null,noise:e=>{let t=Math.random();return[t*e.red,t*e.green,t*e.blue,e.alpha]},grayscale:e=>{let t=.2126*e.red+.7152*e.green+.0722*e.blue;return[t,t,t,e.alpha]},invert:e=>[255-e.red,255-e.green,255-e.blue,e.alpha],threshold:e=>.2126*e.red+.7152*e.green+.0722*e.blue>=100?[255,255,255,255]:[0,0,0,255],sobel:e=>{let t=Math.abs(e.x),r=Math.abs(e.y);return[e.red+t,e.green+r,e.blue+(t+r)/4,255]},pixel:e=>e.offset%10!=0?[window.red,window.green,window.blue,255]:(window.red=e.red,window.green=e.green,window.blue=e.blue,[e.red,e.green,e.blue,255])};a.filter=t[e.value]})}),Array.from(document.querySelectorAll('[name="mirror"]')).forEach(e=>{e.addEventListener("change",()=>{a.mirror="1"===e.value})}),document.querySelector('[name="snap"]').addEventListener("click",()=>{let e=a.snap(),t=document.createElement("canvas");t.setAttribute("width",400),t.setAttribute("height",300),t.getContext("2d").putImageData(e,0,0),(null!==n.querySelector("img")||n.querySelectorAll("canvas").length>=16)&&(n.innerHTML=""),n.appendChild(t)}),Array.from(document.querySelectorAll('[name="format"]')).forEach(e=>{e.addEventListener("change",()=>{u()})}),document.querySelector('[name="quality"]').addEventListener("input",()=>{u()})}]);